#!/usr/bin/env node
var path = require('path');
var spawn = require('child_process').spawn;
var program = require('commander');

program
  .version(require('../package.json').version)
  .option('-s, --start', 'start node distribute')
  .option('-c, --configure [editor]', 'opens up editor to edit configuration file')
  .option('-u, --regenerate-user', 'regenerates the user in config.json')
  .option('-r, --redis [url]', 'sets the redis url', 'http://localhost:6379')
  .parse(process.argv);

  if (!process.argv.slice(2).length) {
    program.outputHelp();
  }

process.env.REDIS_URL = program.redis;

if (program.start) {
    GLOBAL.wildcards = {};
    require('../operations/startup.js')();
}

if (program.configure) {
    var file = path.resolve(__dirname, '..', 'config', 'config.json');
    var editor = program.configure || process.env.VISUAL || process.env.EDITOR || (/^windows/.test(process.platform) ? 'notepad' : 'vim');
    var args = editor.split(/\s+/);
    var bin = args.shift();

    var ps = spawn(bin, args.concat([ file ]), { stdio: 'inherit' });
}

if(program.regenerateUser) {
    var Config = require('../operations/lib/config');
    var config = Config.generate();
    console.log(config);
}
